## å‰è¨€

Ahri è¿™ä¸ªå®éªŒæ€§çš„é¡¹ç›®æˆ‘å·²ç»åœæ­¢ç»´æŠ¤äº†ã€‚

æœ‰å„ç±»**å†…ç½‘ç©¿é€**éœ€æ±‚çš„äººï¼Œçœ‹è¿™é‡Œ[frp](https://github.com/fatedier/frp)ã€‚

**ç§‘å­¦ä¸Šç½‘**éœ€æ±‚ï¼Œç»§ç»­é˜…è¯»ä¸‹æ–‡ã€‚

**æˆ‘å·²ç»ç‹¬ç«‹å®Œæˆäº†å¦ä¸€ä¸ªä¸“é—¨ç”¨äºç§‘å­¦ä¸Šç½‘çš„å·¥å…·ï¼Œæˆ‘ç§°å‘¼taä¸º SpreadX**ã€‚å…³äºtaçš„èƒ½åŠ›ï¼Œæˆ‘åªèƒ½è¯´éå¸¸ä¸é”™ã€‚æˆ‘ç”¨äº†å¾ˆä¹…ï¼Œè¿˜å¼€å‘äº† macOS çš„å®¢æˆ·ç«¯ã€‚
æˆ‘å›½ï¼ˆä¸­å›½ğŸ‡¨ğŸ‡³ï¼‰å›½æ°‘ç´ è´¨é€æ­¥æé«˜ï¼Œæˆ‘æ„¿æ„ç›¸ä¿¡èƒ½çœ‹åˆ°æœ¬æ–‡çš„äººéƒ½æ˜¯æœ‰è¾ƒé«˜ç´ è´¨çš„å›½æ°‘ï¼Œä¸ä¼šåšç ´åå›½å®¶å®‰å…¨çš„äº‹æƒ…ã€‚

**æ‰€ä»¥ï¼Œæˆ‘å·²å°† SpreadX ç›´æ¥ release åˆ° Ahri çš„ release é¡µé¢**ã€‚
ä½†æ˜¯ï¼Œä¸ºäº†è¿™ä¸ªå·¥å…·èƒ½å­˜æ´»ä¸‹å»ï¼Œ**æˆ‘ä¸ä¼šæä¾›æºç **ã€‚

sha-256 cb65b0f58cc113cd8d897a4eb8fa532d8ccc2a56b7c7c0bbddb9df558fe2155b

å¦‚æœæœ‰äººä¸‹è½½äº†å®ƒï¼Œå¹¶æ‹…å¿ƒä½¿ç”¨æ—¶æœ‰å®‰å…¨é—®é¢˜ï¼Œè¯·è‡ªè¡Œæ­å»ºæµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œæˆ–è€…åç¼–è¯‘è§£æã€‚
æœ¬äººæ‰¿è¯ºï¼Œè¯¥å·¥å…·æºç ä»…åŒ…å«è¯¥å·¥å…·è‡ªèº«çš„èƒ½åŠ›ï¼Œä¸å«æœ‰ä»»ä½•æ¶æ„ä»£ç ã€‚

æ—¶é—´ï¼ˆ2021-08-17 10:35:00ï¼‰

---

# Ahri

[Ahri](https://github.com/GavinGuan24/ahri) æ˜¯ä¸€ä¸ªé«˜æ•ˆä¸”æ˜“ç”¨çš„ç½‘ç»œç¯å¢ƒå…±äº«å·¥å…·ã€‚

ä½ åªéœ€è¦æœ‰ä¸€ä¸ªæ‹¥æœ‰å…¬ç½‘ IP çš„ VPS ä¾¿å¯ä»¥ä½¿ç”¨ Ahri åŒæ—¶è®¿é—®å¤šä¸ªå†…ç½‘ç¯å¢ƒï¼Œå¹¶ä¸”æ”¯æŒä½¿ç”¨å…¬ç½‘æœåŠ¡å™¨çš„ç½‘ç»œç¯å¢ƒã€‚

Ahri åªæƒ³åšå¥½ä¸‰ä»¶äº‹ã€‚

1. æ ¸å¿ƒï¼šä¸€å°ç”µè„‘åŒæ—¶ä½¿ç”¨å¤šä¸ªå†…ç½‘ç¯å¢ƒï¼Œä¸”ä¸å¹²é¢„å…¶ä»–æ­£å¸¸çš„ç½‘ç»œè®¿é—®ã€‚
2. è¾…åŠ©ï¼šå…è®¸ä½¿ç”¨å…¬ç½‘æœåŠ¡å™¨çš„ç½‘ç»œç¯å¢ƒã€‚
3. æ˜“ç”¨ï¼šæš´éœ²å‡ºå°½å¯èƒ½å°‘çš„é…ç½®å‚æ•°ï¼Œé¿å…ç»™ä½¿ç”¨è€…å¸¦æ¥å›°æ‰°ï¼Œé™ä½å­¦ä¹ ä½¿ç”¨æˆæœ¬ã€‚åŒæ—¶ï¼Œå°½å¯èƒ½çš„ä¸ºæ¯ä¸€ä¸ªé…ç½®å‚æ•°ç»™å‡ºé€šç”¨çš„é»˜è®¤å€¼ï¼Œå°†å¤æ‚ä¸æŠ€æœ¯ç»†èŠ‚ç•™ç»™å¼€å‘è€…ã€‚

è¯·ä¸è¦å°† Ahri ä¸ [frp](https://github.com/fatedier/frp)ï¼ŒSSRï¼ŒV2Ray ç­‰é¡¹ç›®åšæ¯”è¾ƒï¼Œå› ä¸º Ahri å¯¹ä½¿ç”¨åœºæ™¯çš„å®šä½ä¸å®ƒä»¬ä¸åŒã€‚

å½“ç„¶ï¼Œå¦‚æœä½ æœ‰ä¼˜åŒ– Ahri çš„æ„è§å’Œå»ºè®®ï¼Œæˆ‘å¾ˆä¹æ„æ¥å—ã€‚

- [Ahri çš„ç‰¹æ€§](#feature)
- [ç¼–å†™ Ahri çš„åˆè¡·](#original_intention)
- [Ahri çš„ä½¿ç”¨åœºæ™¯](#situation)
- [Ahri çš„å·¥ä½œåŸç†](#principle)
    - [ahri-server & ahri-client](#server_client)
    - [Ahri Protocal](#ahri_protocal)
    - [ahri.hosts ç¤ºä¾‹](#ahri_hosts_examples)
    - [åœºæ™¯è§£æ](#analysis)
- [Ahri çš„ç”¨æ³•](#usage)
- [Ahri http(s)ä»£ç†å®è·µ](#practice)
- [Q & A](#Q_A)

## <a id="feature">Ahri çš„ç‰¹æ€§</a>

|ç‰¹æ€§|è¯¦æƒ…|
|:--:|:--|
|é€šç”¨æ€§|Ahri åŸºäº TCPï¼Œæ‰€ä»¥ä¸å…³å¿ƒè½¬å‘çš„æ•°æ®åŒ…æ˜¯åŸºäºä½•ç§åº”ç”¨å±‚åè®®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ Ahri ä¸€å®šæ”¯æŒ httpã€‚ç†è®ºä¸Šè®²ï¼Œta æ”¯æŒæ‰€æœ‰åŸºäº TCP çš„ä¸Šå±‚åè®®ã€‚|
|å¸§åŒ–æ•°æ®åè®®|Ahri æ‹¥æœ‰è‡ªå·±çš„åº”ç”¨å±‚åè®®ï¼ˆAhri protocolï¼‰æ¥ç»è¡Œæµé‡è½¬å‘ã€‚Ahri å¯¹æµé‡çš„å¤„ç†æ–¹å¼ç±»ä¼¼äº http 2.0ï¼Œæ‰€æœ‰çš„æ•°æ®å‡æ˜¯ **å¸§åŒ–** çš„ã€‚|
|å®‰å…¨|Ahri é‡‡ç”¨äº† **RSA**, **AES-256-CFB** åŠ å¯†ç®—æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚|
|é«˜æ•ˆ|Ahri ç”± golang ç¼–å†™ï¼Œæœ¬èº«éå¸¸åº•å±‚ï¼Œæ‰§è¡Œæ•ˆç‡æé«˜ã€‚åŒæ—¶ï¼ŒAhri é‡‡ç”¨ **å¤šè·¯å¤ç”¨** æ¨¡å¼ï¼Œåœ¨ client ä¸ server ä¹‹é—´ä»…å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼Œé¿å…ä¸å¿…è¦çš„åè®®æ¡æ‰‹ã€‚|
|ä½å†…å­˜, ä½ CPU ä½¿ç”¨ç‡|é‡‡ç”¨ **sync.pool** é™ä½ GC å‹åŠ›ä¸å†…å­˜å ç”¨é‡ã€‚* ahri-client æ´»è·ƒæ—¶ï¼ŒMEM < 7.0MBï¼Œ%CPU ~= 10%ï¼Œ%CPU max < 15.0% ã€‚* ahri-server æ´»è·ƒæ—¶ï¼ŒMEM < 15.0MBï¼Œ%CPU ~ 1.5%ï¼Œ%CPU max < 2.1%ã€‚|
|è·¨å¹³å°|Ahri ç”± golang ç¼–å†™ï¼Œè½»æ¾è·¨å¹³å°ï¼›|

*æœ€ç®€æ¨¡å‹ä¸‹çš„å†…å­˜æµ‹è¯•ç¯å¢ƒä¸æƒ…æ™¯ï¼š

- åœ¨ä¸­å›½å¤§é™†è¿ç»­è®¿é—®æ•°ä¸ª YouTube 1080p è§†é¢‘æ’­æ”¾é¡µï¼ˆå³ï¼Œå½“è§†é¢‘å¼€å§‹æ’­æ”¾æ—¶ï¼Œé©¬ä¸Šç‚¹å‡»ä¸‹ä¸€ä¸ªè§†é¢‘åœ°å€ï¼Œä½¿æœºå™¨ä¿æŒæ•°ä¸ªæŒç»­çš„å¤§æµé‡çš„ç½‘ç»œè®¿é—®ï¼‰ã€‚
- ahri-client è¿è¡Œåœ¨ MacBook Pro <Retina, 13-inch, Early 2015> ä¹ä¸ç‰ˆä¸Šã€‚
- ahri-server è¿è¡Œåœ¨ Vultr çš„ LA èŠ‚ç‚¹çš„ VPS ä¸Š <CentOS 7 x64 5.1.14-1.el7.elrepo.x86_64, CPU 1 vCore, RAM 1GB,> ã€‚

## <a id="original_intention">ç¼–å†™ Ahri çš„åˆè¡·</a>

åœ¨å·¥ä½œä¸­ï¼Œå› å•†åŠ¡åˆä½œéœ€è¦ä½¿ç”¨å‡ å®¶åˆä½œå…¬å¸çš„å†…ç½‘ç¯å¢ƒï¼Œå¯¼è‡´æˆ‘éœ€è¦é¢‘ç¹åˆ‡æ¢ VPN é…ç½®ã€‚
è€Œå›åˆ°å®¶ä¸­ï¼Œå¦‚æœå¶é‡çªå‘æƒ…å†µåˆæ— æ³•ä½¿ç”¨è‡ªå·±å…¬å¸çš„å†…ç½‘ï¼ˆå› ä¸ºè¿ç»´ä¸ç»™é…ï¼‰ã€‚
TeamViewer ä¸ªäººç‰ˆè™½ç„¶å…è´¹ï¼Œä½†æ—¶ä¸æ—¶ä¼šå‡ºç°æœåŠ¡å™¨å®•æœºçš„æƒ…å†µã€‚
å¥³å‹å…¬å¸çš„è¿ç»´é…ç½®çš„ VPN ä¸ç¨³å®šã€‚

ä¸€ç³»åˆ—çš„æ¼äººäº‹ä»¶å‘ç”Ÿåï¼Œæˆ‘å†³å®šç¼–å†™ Ahri æ¥æ”¹å–„æˆ‘çš„å·¥ä½œä¸ç”Ÿæ´»è´¨é‡ã€‚åŒæ—¶ï¼Œå¸Œæœ› Ahri å¯ä»¥å¸®åŠ©é‚£äº›é‡åˆ°ç±»ä¼¼æƒ…å†µçš„äººã€‚

**æ³¨æ„: è¯·ä¸¥æ ¼éµå®ˆä½ æ‰€åœ¨åœ°åŒºçš„ç›¸å…³æ³•å¾‹æ³•è§„, ä¸è¦å°† Ahri ç”¨äºè¿æ³•çŠ¯ç½ªè¡Œä¸º(å°¤å…¶æ˜¯ç§‘å­¦ä¸Šç½‘); å¦åˆ™åæœè‡ªè´Ÿ, æ¯•ç«ŸæŠ€æœ¯æ— ç½ª, æœ€åçš„æƒ…å†µæˆ‘ä¼šæ¸…é™¤æºç .**

 
## <a id="situation">Ahri çš„ä½¿ç”¨åœºæ™¯</a>

Ahri é€‚ç”¨äºä½†ä¸å±€é™äºä»¥ä¸‹åœºæ™¯ï¼Œta å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚

**åœºæ™¯ä¸€**

ä½ çš„å·¥ä½œå†…å®¹éœ€è¦ä½¿ç”¨åˆ°å…¬å¸å†…ç½‘ï¼Œä½†ç”±äºå¤–å› ï¼Œæ²¡æœ‰ VPN æˆ–æ ¹æœ¬æ— æ³•ä½¿ç”¨ã€‚

TeamViewer æ— æ³•è¿æ¥åˆ°å…¬å¸å†…ç½‘çš„ç”µè„‘æˆ–ä½¿ç”¨æ—¶åŠå…¶å¡é¡¿ã€‚

ä½œä¸ºå¼€å‘ï¼Œéœ€è¦ä½¿ç”¨åˆ°å‡ ä¸ªä¸­é—´ä»¶ï¼Œè€Œå®ƒä»¬éƒ½åœ¨å…¬å¸å†…ç½‘ã€‚

**åœºæ™¯äºŒ**

å› å•†åŠ¡åˆä½œéœ€è¦ä½¿ç”¨å‡ å®¶åˆä½œå…¬å¸çš„å†…ç½‘ç¯å¢ƒï¼Œé¢‘ç¹åˆ‡æ¢ VPN é…ç½®éå¸¸éº»çƒ¦ã€‚

**åœºæ™¯ä¸‰**

ä½ æ‰€åœ¨çš„ç½‘ç»œç¯å¢ƒå¯¹ä¸€äº›å…¬ç½‘åŸŸåæˆ– IP è¿›è¡Œäº†æ‹¦æˆªï¼Œå¯¼è‡´ä½ æ— æ³•ä½¿ç”¨å®ƒä»¬ã€‚

## <a id="principle">Ahri çš„å·¥ä½œåŸç†</a>

Ahri éœ€è¦è§£å†³çš„é—®é¢˜å…¶å®æ˜¯æµé‡è½¬å‘ã€‚ç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æµé‡éƒ½éœ€è¦è½¬å‘ï¼Œæˆ–å¤šæ¬¡è½¬å‘ã€‚
æ‰€ä»¥ï¼Œå°±è¯·æ±‚çš„å‘èµ·æ¥è¯´ï¼Œæµé‡çš„ç›®çš„åœ°æœ‰ä¸‰ç§ç±»å‹ã€‚

1. æœ¬åœ°ï¼šåœ¨æœ¬æœºç›´æ¥æ‹¨å·ï¼ˆdialï¼‰TCP è¯·æ±‚ã€‚
2. ahri-serverï¼š ä½¿ç”¨ ahri-server ä½œä¸ºä»£ç†ï¼Œåœ¨ ahri-server ä¸Š dial TCP è¯·æ±‚ã€‚
3. å¦ä¸€ä¸ª ahri-clientï¼š ä½¿ç”¨å¦ä¸€ä¸ª ahri-client ä½œä¸ºä»£ç†ï¼Œåœ¨å¦ä¸€ä¸ª ahri-client ä¸Š dial TCP è¯·æ±‚ã€‚

### <a id="server_client">ahri-server & ahri-client</a>

Ahri æœåŠ¡ç”±ä¸¤ä¸ªäºŒè¿›åˆ¶ç¨‹åºæ¥æä¾›ï¼Œå®ƒä»¬æ˜¯ ahri-serverï¼Œahri-clientã€‚

- ahri-server è´Ÿè´£å“åº”æ¥è‡ª ahri-client çš„è¯·æ±‚ï¼Œæˆ–è€…è½¬å‘ä¸€ä¸ª ahri-client çš„è¯·æ±‚ç»™å¦ä¸€ä¸ª ahri-clientã€‚

- ahri-client è´Ÿè´£å‘èµ·è¯·æ±‚ï¼Œæˆ–è€…å“åº”å¦ä¸€ä¸ª ahri-client çš„è¯·æ±‚ã€‚ta æœ‰ä¸‰ä¸ªæ¨¡å¼ã€‚
    - takeï¼šå¯åŠ¨ä¸€ä¸ª socks5 æœåŠ¡æ¥æ¥å—æœ¬åœ°çš„æ‰€æœ‰ TCP è¯·æ±‚ï¼›å†æŒ‰é…ç½®å¥½çš„æ˜ å°„æ–‡ä»¶ï¼ˆahri.hostsï¼‰å†³å®šé‡‡ç”¨ä¸Šé¢çš„ä¸‰ç§æµé‡ç›®çš„åœ°ä¸­çš„å“ªä¸€ä¸ªã€‚
    - giveï¼šä»…è´Ÿè´£å“åº”æ¥è‡ªå…¶ä»– ahri-client çš„è¯·æ±‚ã€‚
    - tradeï¼šåŒæ—¶æ”¯æŒä¸Šé¢ä¸¤ç§çš„æ¨¡å¼ã€‚

ahri-client é‡‡ç”¨ä¸»åŠ¨æ³¨å†Œåˆ° ahri-server çš„æ–¹å¼æ¥è¿›è¡Œè¿æ¥ï¼Œè€Œ ahri-server ä¼šå¯¹æ•°ä¸ª ahri-client è¿›è¡Œç®¡ç†ã€‚
ahri-client æ³¨å†Œåˆ° ahri-server åï¼Œå®ƒä»¬ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªå†…å®¹åŠ å¯†çš„ TCP è¿æ¥ã€‚åœ¨è¿™ä¸ªè¿æ¥ä¸­ä¼šä¼ é€’å¿ƒè·³åŒ…ä¸å„ç±»æ•°æ®åŒ…ã€‚

ç„¶åå†è§£é‡Šä¸Šé¢æŒ–çš„ä¸€ä¸ªå‘ï¼Œå¯¹ä¸€ä¸ª TCP è¿æ¥ç»è¡Œå¤šè·¯å¤ç”¨ã€‚

### <a id="ahri_protocal">Ahri Protocal</a>

åŸºäº TCP ï¼ŒAhri è‡ªè¡Œå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨å±‚åè®® [Ahri Protocol](https://github.com/GavinGuan24/ahri/blob/master/core/ahri_protocol.md)ã€‚
ta ç”± Ahri Registe Protocolï¼ˆARPï¼‰ä¸ Ahri Frame Protocolï¼ˆAFPï¼‰ç»„æˆã€‚
ARP å®šä¹‰äº† ahri-client åº”è¯¥æ€æ ·æ³¨å†Œåˆ° ahri-serverã€‚
AFP å®šä¹‰äº† ahri-client ä¸ ahri-server åº”è¯¥æ€æ ·äº¤äº’æ•°æ®åŒ…ã€‚
è¯¦ç»†çš„å†…å®¹è¯·æŸ¥çœ‹[Ahri Protocol](https://github.com/GavinGuan24/ahri/blob/master/core/ahri_protocol.md)ã€‚

åœ¨è¿™é‡Œæˆ‘ä»…æƒ³è¯´æ˜ï¼Œåè®®ä¸­å‡ºç°äº† Frameï¼Œè¡¨æ˜ Ahri å°†æ•°æ®åšäº†å¸§åŒ–ï¼Œå¯¹æ•°æ®åŒ…çš„ç®¡ç†æ–¹å¼ç±»ä¼¼äº HTTP 2.0ã€‚åœ¨è¿™æ ·çš„å‰æä¸‹ï¼Œä»…ä½¿ç”¨ä¸€ä¸ª TCP è¿æ¥ä¾¿å¯ä»¥ä½¿ ahri-client ä¸ ahri-server æ²Ÿé€šé¡ºç•…ã€‚

ä¸ºäº†è®© ahri-server ç®¡ç†æ•°ä¸ª ahri-clientï¼ŒARP è§„å®šæ¯ä¸€ä¸ª ahri-client å‡æœ‰ä¸€ä¸ªåå­—ï¼ˆæœ€å¤§é•¿åº¦ä¸º 2 çš„ACSIIå­—ç¬¦ï¼‰ã€‚
æ¯ä¸€ä¸ª ahri-client å‡æœ‰ä¸€ä¸ª ahri.hosts æ–‡ä»¶ï¼Œå¯ä»¥æ§åˆ¶æœ¬åœ°è¯·æ±‚è½¬å‘çš„ç›®çš„åœ°ï¼›ä¹Ÿå¯æ§åˆ¶æ˜¯å¦å¯¹ä»–äººæä¾›æŸäº›åŸŸåæˆ– IP çš„è½¬å‘æœåŠ¡ã€‚
**å…¶ä¸­ 'S', 'L', '-', '|' ä¸ºç³»ç»Ÿä¿ç•™å, ç¦æ­¢ä½¿ç”¨å®ƒä»¬å¯¹ ahri-client å‘½å.**

#### <a id="ahri_hosts_examples">ahri.hosts ç¤ºä¾‹</a>

æˆ‘ä»¬å‡è®¾è‡ªå·±çš„å®¢æˆ·ç«¯åä¸º 'A', å¦ä¸€ä¸ªå®¢æˆ·ç«¯åä¸º 'B', ä¸”å‡æ³¨å†Œè‡³æœåŠ¡ç«¯ S, ä»¥ä¸‹å°±æ˜¯ ahri.hosts æ–‡ä»¶çš„ç¤ºä¾‹.

```
# è½¬å‘æœ¬åœ°è¯·æ±‚è‡³æœåŠ¡ç«¯
youtube.com S

# è½¬å‘æœ¬åœ°è¯·æ±‚è‡³å¦ä¸€ä¸ªå®¢æˆ·ç«¯ B
mary-live.com B

# å½“å‰ ahri-client ä¸º give æˆ– trade æ¨¡å¼æ—¶, ç¦æ­¢å…¶ä»–å®¢æˆ·ç«¯è®¿é—®æœ¬åœ°ç½‘ç»œç¯å¢ƒä¸­çš„è¿™ä¸ªåŸŸå
tom-live.com -

# å½“å‰ ahri-client é‡åˆ°è¯¥åŸŸåæ—¶, æ‹¦æˆªæœ¬åœ°è¯·æ±‚, ä¸€èˆ¬ç”¨äºå¹¿å‘Šå±è”½
ad-live.com |

# æ˜¾å¼è¡¨æ˜è¯·æ±‚åº”è¯¥åœ¨æœ¬åœ°å¤„ç†, å½“ç„¶æ‰€æœ‰è¯·æ±‚çš„é»˜è®¤ç›®çš„åœ°å°±æ˜¯ L, æ‰€ä»¥å¯ä»¥ä¸å†™ä¸‹é¢è¿™ä¸€è¡Œ.
baidu.com L
```

### <a id="analysis">åœºæ™¯è§£æ</a>

æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸Šé¢çš„ä½¿ç”¨åœºæ™¯ã€‚
å‡è®¾æˆ‘æœ¬æœº ahri-client æ˜¯ Aï¼Œ
æˆ‘ä½¿ç”¨çš„ ahri-server æ˜¯ Sï¼Œ
æˆ‘å…¬å¸å†…ç½‘ï¼ˆLAN 1ï¼‰ä¸­æœ‰ä¸€ä¸ª ahri-client æ˜¯ Bï¼Œ
åˆ«äººå…¬å¸å†…ç½‘ï¼ˆLAN 2ï¼‰ä¸­æœ‰ä¸€ä¸ª ahri-client æ˜¯ Cã€‚

**åœºæ™¯ä¸€ & åœºæ™¯äºŒ**

è¿™ä¸¤ä¸ªåœºæ™¯æ˜¯æœ€å¸¸è§çš„ VPN ä½¿ç”¨åœºæ™¯ï¼Œåªä¸è¿‡åœºæ™¯äºŒç•¥å¤æ‚ä¸€ç‚¹ã€‚

å½“æˆ‘åœ¨è‡ªå·±å®¶æ—¶ã€‚
æˆ‘ä½¿ç”¨è‡ªå·±å…¬å¸çš„å†…ç½‘æ—¶ï¼Œæµé‡èµ°å‘æ˜¯
A -> S -> B -> LAN 1ï¼Œ ç„¶ååŸè·¯è¿”å›ã€‚
æˆ‘ä¹Ÿå¯ä»¥ä½¿ç”¨å¯¹æ–¹å…¬å¸çš„å†…ç½‘ï¼Œæµé‡èµ°å‘æ˜¯
A -> S -> C -> LAN 2ï¼Œ ç„¶ååŸè·¯è¿”å›ã€‚
æˆ‘ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ä»»ä½•å…¬ç½‘èµ„æºï¼ŒA -> Internetã€‚

å½“æˆ‘åœ¨è‡ªå·±å…¬å¸ï¼Œä½¿ç”¨è‡ªå·±å…¬å¸çš„å†…ç½‘æ—¶ï¼Œæµé‡èµ°å‘æ˜¯
A -> LAN 1ï¼Œç„¶ååŸè·¯è¿”å›ã€‚
æˆ‘ä¹Ÿå¯ä»¥ä½¿ç”¨å¯¹æ–¹å…¬å¸çš„å†…ç½‘ï¼Œæµé‡èµ°å‘æ˜¯
A -> S -> C -> LAN 2ï¼Œ ç„¶ååŸè·¯è¿”å›ã€‚
æˆ‘ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ä»»ä½•å…¬ç½‘èµ„æºï¼ŒA -> Internetã€‚

**åœºæ™¯ä¸‰**

å¯¹è¿™ä¸ªåœºæ™¯çš„å¤„ç†å…¶å®æ˜¯æˆ‘åœ¨å®ç°åœºæ™¯ä¸€ã€äºŒçš„è¿‡ç¨‹ä¸­é¡ºå¸¦å†™å‡ºæ¥çš„è¡ç”Ÿç‰©ã€‚
ä¸»è¦å°±æ˜¯ä½ æ‰€åœ¨çš„ç½‘ç»œç¯å¢ƒä¼šå¯¹ä¸€äº›å…¬ç½‘èµ„æºçš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªã€‚
A -> Internet è¿™æ¡è·¯ä¸é€šäº†ã€‚æ‰€ä»¥æ¢çº¿ä¸º A -> S -> Internetã€‚

å¸Œæœ›æˆ‘å¯¹ä¸Šé¢çš„åœºæ™¯çš„è§£å†³æè¿°çš„è¶³å¤Ÿæ¸…æ¥šã€‚


![ç¤ºæ„å›¾](https://github.com/GavinGuan24/ahri/blob/master/img/a0.jpg)

## <a id="usage">Ahri çš„ç”¨æ³•</a>

æˆ‘å·²ç»å¯¹å¸¸ç”¨çš„ç³»ç»Ÿå®Œæˆäº†æºç ç¼–è¯‘çš„å·¥ä½œ, ä½ åº”è¯¥å¯ä»¥åœ¨ [releases](https://github.com/GavinGuan24/ahri/releases/tag/v0.9.3) ä¸­æ‰¾åˆ°å¯è¿è¡Œåœ¨ä½ ç³»ç»Ÿä¸Šçš„ç‰ˆæœ¬. å¦‚æœæ²¡æœ‰, è¯·è‡ªè¡Œä»æºç ç¼–è¯‘(go1.12.1+).

è¯¦ç»†å‚æ•°ä¸è§£é‡Šä»…éœ€è¦åœ¨å‘½ä»¤è¡Œä¸‹æ‰§è¡Œå¯¹åº”çš„å¸®åŠ©ç¨‹åºï¼ˆ**å› ä¸º windows çš„é™åˆ¶ï¼Œéœ€è¦å°† ahri-client ä¸ ahri-server å…ˆé‡å‘½åä¸º ahri-client.exe ä¸ ahri-server.exe**ï¼‰

```
å®¢æˆ·ç«¯
ahri-client -h

æœåŠ¡ç«¯
ahri-server -h

# windows ä¸‹

ahri-client.exe -h
ahri-server.exe -h
```

**æ–¹æ³•ä¸€**

ç›´æ¥è¿è¡Œ ahri-client / ahri-server, å‚æ•°å¦‚ä¸‹.

```
Usage: ./ahri-client <server-info> <client-info> [socks5-cfg] [global-cfg]
    server-info: -sip serverIp, -sp serverPort, -k serverPassword
    client-info: -n clientName, -m clientMode
    socks5-cfg:  -s5ip socks5Ip, -s5p socks5Port, -f ahriHostsFile
    global-cfg: -L logLevel, -T timeoutUnitSec

Parameters:
  -L int
    	the log level, 0 ~ 3 ==> debug, info, warn, error (default 3)
  -T int
    	the timeout of one-way communication time interval between an AhriClient and an AhriServer;
    	Special: AhriClient Dial timeout = 3T, heartbeat timeout = 2T (default 5)
  -f string
    	the ahri hosts file of this ahri client (default "ahri.hosts")
  -k string
    	the password of an ahri server
  -m int
    	the work mode of this ahri client, 0: Take, 1: Give, 2: Trade
  -n string
    	the name of this ahri client
  -s5ip string
    	the socks5 IP of this ahri client (default "127.0.0.1")
  -s5p string
    	the socks5 port of this ahri client (default "23456")
  -sip string
    	the IP of an ahri server
  -sp string
    	the port of an ahri server

```

```
Usage: ./ahri-server <server-info> [global-cfg]
    server-info: -ip serverIp, -p serverPort, -k serverPassword, -a rsaPrivateKey, -b rsaPublicKey
    global-cfg: -L logLevel, -T timeoutUnitSec

Parameters:
  -L int
    	the log level, 0 ~ 3 ==> debug, info, warn, error (default 3)
  -T int
    	the timeout of one-way communication time interval between an AhriClient and an AhriServer;
    	Special: AhriClient Dial timeout = 3T, heartbeat timeout = 2T (default 5)
  -a string
    	the private rsa key file of this ahri server (default "rsa_private_key.pem")
  -b string
    	the public rsa key file of this ahri server (default "rsa_public_key.pem")
  -ip string
    	the IP of an ahri server
  -k string
    	the password of an ahri server
  -p string
    	the port of an ahri server

```

ä½¿ç”¨ ahri-client, ä½ å‡ ä¹ä»…é…ç½® ahri.hosts å³å¯ä½¿ç”¨.
ä½¿ç”¨ ahri-server, ä½ éœ€è¦ openssl å¸®ä½ ç”Ÿæˆ RSA å…¬ç§é’¥å¯¹, å¦‚æœä½ æ˜¯ *nix ç¯å¢ƒ, å¯ä»¥ç›´æ¥è°ƒç”¨ `bash gen_rsa_keys.sh`.

**æ–¹æ³•äºŒ**

ä¸ºäº†é™ä½é…ç½®éš¾åº¦ï¼Œå‹ç¼©åŒ…ä¸­å·²åŒ…å« start.shï¼Œstop.sh ã€‚
ä»…éœ€è¦ä¿®æ”¹å¿…è¦çš„å‚æ•°å³å¯åœ¨ *nix ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
è‡³äº Windowsï¼Œå‚è€ƒ sh è„šæœ¬å³å¯ç¼–å†™ bat å³å¯ã€‚

æç¤ºï¼šå¦‚æœ ahri-client ä¸ ahri-server ä¹‹é—´çš„ç½‘ç»œç¯å¢ƒæ˜¯ **ä½å¸¦å®½** æˆ– **é«˜å»¶è¿Ÿ**ï¼Œè¯·é€‚å½“å¢å¤§ `-T` å‚æ•°çš„å€¼ã€‚

## <a id="practice">Ahri http(s)ä»£ç†å®è·µ</a>

Ahri å…¶å®å¾ˆç®€å•ï¼Œä½†å¯¹äºä¸ç†Ÿæ‚‰ç»ˆç«¯çš„ç«¥é‹è¿˜æ˜¯å¤ªéš¾äº†ï¼Œé‚£ä¹ˆè·Ÿç€è¿™ä¸ª[ã€å®è·µæ•™ç¨‹ã€‘](https://github.com/GavinGuan24/ahri/blob/master/core/ahri_guide.md)ï¼Œä½ å¯ä»¥å­¦ä¹ åˆ°åŸºç¡€ç”¨æ³•ã€‚


## <a id="Q_A">Q & A</a>

æˆ‘å·²æµ‹è¯•å¹¶æ­£å¸¸ä½¿ç”¨è¯¥å·¥å…·å¤šæ—¶ï¼Œæœ‰ä»»ä½•æ„è§ä¸å»ºè®®æˆ–è€…é—®é¢˜ï¼Œè¯· open ä¸€ä¸ª [issues](https://github.com/GavinGuan24/ahri/issues)ã€‚

### ahri-client çš„å‘½å

ahri-client å¯ä»¥ä½¿ç”¨æœ€é•¿ 2 ä¸ª ASCII å­—ç¬¦ï¼ˆä½ å°±å½“åšä¸¤ä¸ªè‹±æ–‡å­—æ¯å¥½äº†ï¼‰æ¥å‘½åè‡ªèº«ã€‚åŒæ—¶ 'S'ï¼Œ 'L'ï¼Œ '-'ï¼Œ '|' å‡æ˜¯ç³»ç»Ÿä¿ç•™åï¼Œç¦æ­¢ä½¿ç”¨ã€‚
ä¸ºä»€ä¹ˆæœ€é•¿ 2 ä¸ªå­—ç¬¦ï¼Ÿç”± ARP å†³å®šçš„ã€‚å¦‚æ­¤ï¼Œä¸€å°æœåŠ¡å™¨å·²ç»å¯ä»¥é€‰ (256^2 - 4) ä¸ªå®¢æˆ·ç«¯åï¼Œè¶³å¤Ÿä½¿ç”¨ã€‚

### windows çš„å‘½ä»¤è¡Œä¸­æ— æ³•è¿è¡Œ Ahri çš„äºŒè¿›åˆ¶æ–‡ä»¶

å› ä¸º Ahri çš„äº¤å‰ç¼–è¯‘è„šæœ¬ä¸­ï¼Œé»˜è®¤ä½¿ç”¨ ahri-client ä¸ ahri-server è¿™ä¸¤ä¸ªåå­—å‘½åäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œ windows è¦æ±‚å¯æ‰§è¡Œæ–‡ä»¶ä»¥ `exe` ä½œä¸ºåç¼€åã€‚
æ‰€ä»¥ï¼Œå°† ta ä»¬é‡å‘½ååŠ ä¸Š `.exe` å³å¯ã€‚

### å…³äºå…¶ä»–å¸¸ç”¨å·¥å…·çš„å¯¹æ¥ Ahri

ä¸€èˆ¬æ¥è¯´ï¼Œè‡³å°‘åœ¨ *nix ç¯å¢ƒä¸‹ç»å¤§å¤šæ•°å·¥å…·çš„å¯¹æ¥éƒ½å¯ä»¥ä½¿ç”¨ nc æ¥è§£å†³ã€‚

ä¸‹é¢æ˜¯ ssh ä½¿ç”¨ nc æ¥å¯¹æ¥ Ahri çš„ä¾‹å­ã€‚

```
ç°åœ¨æœ¬åœ° socks5 ç›‘å¬ä»£ç†æ˜¯ socks5://127.0.0.1:23456
è‡ªå·±æœåŠ¡å™¨æ˜¯server.test.com

ä¿®æ”¹~/.ssh/config æ–‡ä»¶
æ·»åŠ ä¸‹é¢é…ç½®

host server.test.com
HostName server.test.com
ProxyCommand nc -X 5 -x 127.0.0.1:23456 %h %p
ServerAliveInterval 30
ç„¶åé€šè¿‡
ssh user@server.test.com å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨ Ahri ä»£ç†ç™»å½•äº†ã€‚
```


